<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Poké-Album Live</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        :root { --gold: #ffcb05; --rare: #ff00e5; }
        body { background: #121212; color: white; font-family: 'Poppins', sans-serif; margin: 0; padding: 20px; }
        
        .header { margin-bottom: 30px; sticky: top; background: #121212; padding: 10px; }
        input { padding: 12px; border-radius: 25px; border: 2px solid #333; background: #222; color: white; width: 80%; max-width: 300px; margin-bottom: 10px; }
        button { padding: 12px 25px; border-radius: 25px; background: var(--gold); border: none; font-weight: bold; cursor: pointer; transition: 0.3s; }
        button:hover { transform: scale(1.05); background: white; }

        /* Grille Responsive */
        .grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); 
            gap: 15px; max-width: 1000px; margin: 0 auto; 
        }

        @media (min-width: 600px) { .grid { grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); } }

        .card-container { position: relative; cursor: pointer; perspective: 1000px; }
        .card-img { 
            width: 100%; border-radius: 10px; border: 2px solid #333;
            filter: grayscale(100%) brightness(30%); transition: 0.5s;
        }

        .owned .card-img { filter: grayscale(0%) brightness(100%); border-color: var(--gold); }

        /* Effet Brillance (Shiny) pour ID 46-50 */
        .shiny.owned .card-img {
            animation: shine 3s infinite;
            border-color: var(--rare);
            box-shadow: 0 0 15px var(--rare);
        }

        @keyframes shine {
            0% { filter: brightness(1) contrast(1.2); }
            50% { filter: brightness(1.5) contrast(1.5) hue-rotate(20deg); }
            100% { filter: brightness(1) contrast(1.2); }
        }

        .badge { 
            position: absolute; top: -5px; right: -5px; background: red; 
            color: white; border-radius: 50%; width: 28px; height: 28px; 
            display: none; align-items: center; justify-content: center; font-weight: bold; font-size: 12px; border: 2px solid #121212;
        }
        .owned .badge { display: flex; }

        /* Modal (Zoom) */
        #modal { 
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.9); z-index: 1000; justify-content: center; align-items: center; flex-direction: column;
        }
        #modal img { width: 80%; max-width: 400px; border-radius: 15px; border: 3px solid var(--gold); }
        #modal-info { margin-top: 20px; font-size: 1.2em; text-align: center; line-height: 1.6; }
    </style>
</head>
<body>

    <div class="header">
        <h1>ALBUM DE COLLECTION</h1>
        <input type="text" id="pseudo" placeholder="Pseudo Twitch...">
        <button onclick="chargerAlbum()">VOIR MON ALBUM</button>
        <div id="stats" style="margin-top:15px; color: var(--gold); font-weight: bold;"></div>
    </div>

    <div class="grid" id="album"></div>

    <div id="modal" onclick="this.style.display='none'">
        <img id="modal-img" src="">
        <div id="modal-info"></div>
        <p style="color: grey; margin-top: 10px;">(Clique pour fermer)</p>
    </div>

    <script>
        const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vR47QWdhzcXoGqyJc0_OIPnLvPMmeGAofr2RpB-MfvT-7F3rG0ATQ4O5KUtI0u2GkDHV5tTsGfHmC_3/pub?gid=0&single=true&output=csv"; 
        const TOTAL_CARTES = 50;

        function getDropRate(id) {
            if (id <= 30) return { rarity: "Commune", rate: "70%" };
            if (id <= 40) return { rarity: "Rare", rate: "20%" };
            if (id <= 45) return { rarity: "Très Rare", rate: "8%" };
            return { rarity: "ULTRA RARE", rate: "2%" };
        }

        function chargerAlbum() {
            const user = document.getElementById('pseudo').value.toLowerCase().trim();
            Papa.parse(CSV_URL, {
                download: true, header: true,
                complete: function(results) {
                    const data = results.data;
                    const inv = {};
                    let uniques = 0;

                    data.forEach(row => {
                        if(row.Pseudo && row.Pseudo.toLowerCase() === user) {
                            inv[row.ID_Carte] = (inv[row.ID_Carte] || 0) + 1;
                        }
                    });

                    const grid = document.getElementById('album');
                    grid.innerHTML = "";
                    for(let i=1; i<=TOTAL_CARTES; i++) {
                        const count = inv[i] || 0;
                        const info = getDropRate(i);
                        const div = document.createElement('div');
                        div.className = `card-container ${count > 0 ? 'owned' : ''} ${i >= 46 ? 'shiny' : ''}`;
                        div.onclick = () => zoomCard(i, info, count);
                        
                        div.innerHTML = `
                            <img src="img/${i}.png" class="card-img" onerror="this.src='https://via.placeholder.com/150x210?text=?'">
                            <div class="badge">x${count}</div>
                        `;
                        grid.appendChild(div);
                        if(count > 0) uniques++;
                    }
                    document.getElementById('stats').innerText = `PROGRESSION : ${uniques} / ${TOTAL_CARTES} (${Math.floor(uniques/TOTAL_CARTES*100)}%)`;
                }
            });
        }

        function zoomCard(id, info, count) {
            document.getElementById('modal-img').src = `img/${id}.png`;
            document.getElementById('modal-info').innerHTML = `
                <strong style="color:var(--gold)">Carte #${id}</strong><br>
                Rareté : ${info.rarity}<br>
                Taux de drop : ${info.rate}<br>
                Possédée : ${count} fois
            `;
            document.getElementById('modal').style.display = 'flex';
        }
    </script>
</body>
</html>